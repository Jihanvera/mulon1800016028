<!DOCTYPE html>
<html>
    <head>
        <title>audio visualizer with audio element</title>

<style type="text/css">
body {
    background-image: radial-gradient(circle, #F0C505, #F76E2A 10%, #A71A5B 40%, #651366);
    position: relative;
    overflow: hidden;
    text-align: center;
    color: #fff;
}
a{
    color:yellow;
}
.bar-wrapper {
    height: 300px;
    position: relative;
}
.bar {
    position: relative;
    bottom: 0;
    width: 5px;
    display: inline-block;
    border: 1px solid red;
    height: 5px;
    border-bottom: 3px solid #fff;
}
</style>

    </head>
    <body>
    <h3>RESPONSI MULON ||audio visualizer</h3>
   
        <canvas id='canvas' width="800" height="350"></canvas>
        <br>
        <br>
        <audio src="Sesuatu Di Jogja - Adhitia Sofyan (official audio).mp3" id="audio" controls>audio element not supported</audio>
        
    <script>
            window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;
        
        var start = function() {
            var audio = document.getElementById('audio');
            var ctx = new AudioContext();
            var analyser = ctx.createAnalyser();
            var audioSrc = ctx.createMediaElementSource(audio);
            audioSrc.connect(analyser);
            analyser.connect(ctx.destination);
            var frequencyData = new Uint8Array(analyser.frequencyBinCount);
            var canvas = document.getElementById('canvas'),
                cwidth = canvas.width,
                cheight = canvas.height - 2,
                meterWidth = 10, 
                gap = 2, 
                capHeight = 2,
                capStyle = '#fff',
                meterNum = 800 / (10 + 2), 
                capYPositionArray = []; 
            ctx = canvas.getContext('2d'),
            gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(1, '#0f0');
            gradient.addColorStop(0.5, '#ff0');
            gradient.addColorStop(0, '#f00');
            // loop
            function renderFrame() {
                var array = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(array);
                var step = Math.round(array.length / meterNum); 
                ctx.clearRect(0, 0, cwidth, cheight);
                for (var i = 0; i < meterNum; i++) {
                    var value = array[i * step];
                    if (capYPositionArray.length < Math.round(meterNum)) {
                        capYPositionArray.push(value);
                    };
                    ctx.fillStyle = capStyle;
        
                    if (value < capYPositionArray[i]) {
                        ctx.fillRect(i * 12, cheight - (--capYPositionArray[i]), meterWidth, capHeight);
                    } else {
                        ctx.fillRect(i * 12, cheight - value, meterWidth, capHeight);
                        capYPositionArray[i] = value;
                    };
                    ctx.fillStyle = gradient; 
                    ctx.fillRect(i * 12, cheight - value + capHeight, meterWidth, cheight); 
                }
                requestAnimationFrame(renderFrame);
            }
            renderFrame();
            // audio.play();
        };
        
        audio.onplay = function(){
            start();
        }
        </script>
    </body>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46794744-6', 'auto');
      ga('send', 'pageview');

    </script>
</html>